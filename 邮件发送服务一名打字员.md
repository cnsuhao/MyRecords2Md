---
title: 邮件发送服务
date: 2018-02-03 14:22:08
categories: "开发"
tags:
	- Java
	- NoSQL
	- 编程语言
	- Redis
	- HTML

---

# 前言 #

最近公司业务上有需要改造邮件提醒模块，之前基本上就是使用javax的mail包写了一个简单的工具类，然后直接发送邮件，因为需求比较少，所以也就放任这种模式不管。考虑到公司现有系统框架，决定单开一个邮件服务，底层发送还是使用原来的mail包，利用rocketMQ，每次从消息队列中获取需要发送的邮件信息然后进行发送。

# 技术选型 #

 *  SpringBoot

现在公司新项目已经基本上选择使用SpringBoot进行开发，对开发人员来说使用它进行系统间的开发也很便捷，考虑到与老系统之间的对接问题，还是选择使用SpringBoot来作为邮件服务的开发支持。

 *  RockectMQ

考虑到现有系统中已经搭建好的消息环境，以及将来可能会使用其他第三方的消息环境支持，选择RocketMQ无疑是最好的选择，当然针对传统的RPC框架来说，还有很多选择，这里不做展开。

 *  Redis

对于异常或者其它未发送的邮件，利用redis把它存储起来，作为异常处理，方便之后重新进行人工校验或者是定时重发等。

# 实现思路 #

 *  基础环境搭建

使用SpirngBoot来开发，我们能很快的配置好一些基础的环境。另外我们通常会将邮件的一些配置也会放在项目的配置文件application.properties里，方便管理。

 *  邮件发送模块

作为一个邮件发送服务，首先他支持的邮件格式当然也包括不限于普通文本类、HTML格式类、带附件以及模板等等。大家都知道，在Java中发送邮件的方法有JavaMail、Commons Email和Spring Mail。这些网上以及官方文档中都有很好的示例，在这里我们使用JavaMail发送邮件，另外，如果需要自定义昵称，格式以 昵称<邮箱>格式或者new InternetAddress(邮箱,昵称)均可。

另外很多时候我们发送邮件都是有使用固定的模板的，我们一般会使用thymeleaf或者freemarker来实现。

 *  邮件消息消费

当启动我们的消息消费进程的时候，如果接收到一条消息过来，我们会马上根据消息中附带对应的邮件类型以及状态进行发送，当出现消费失败或者发送失败的时候，将失败的信息存入redis中，同时开启一个失败的进程监听，并根据错误信息选择在一段时间后继续发送或者是直接提交人工处理错误。

# 结语 #

以上就是实现一个简单的邮件服务器的基本思路，如果邮件底层不选择自己实现的话，那么需要注意的就是邮件发送错误、失败的时候的处理，这样基本上就能满足一般业务的需求，另外，如果需要发送大批量邮件的话，可以联系我一起交流交流。
 *  **原文作者：** 一名打字员
 *  **原文链接：** https://www.toutiao.com/item/6518209562384794120/
 *  **版权声明：** 本博客所有文章除特别声明外，均采用 [CC BY-NC-SA 4.0][] 许可协议。转载请注明出处。